<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{fragment/layout}">

<head>
    <th:block layout:fragment="css">
        <link rel="stylesheet" th:href="@{/css/myPage.css}">
        <link rel="stylesheet" th:href="@{/css/followingProducts.css}">
        <link rel="stylesheet" th:href="@{/css/heartFollow.css}">
    </th:block>
    <title>팔로잉 목록</title>
</head>

<body>
    <div layout:fragment="content" class="subpage-container">
        <!-- 왼쪽 사이드바 -->
        <div th:replace="~{fragment/myPage_sidebar}"></div>

        <!-- 오른쪽 메인 콘텐츠 -->
        <main class="subpage-content">
            <div class="page-header">
                <h1 class="page-title">팔로잉 목록</h1>
                <p class="page-subtitle">팔로우 중인 작가들의 최신 작품을 확인할 수 있습니다.</p>
            </div>

            <!-- 통계 정보 -->
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-number" th:text="${followingCount != null ? followingCount : 0}">0</div>
                    <div class="stat-label">팔로우 중인 작가</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" th:text="${followings != null ? followings.size() : 0}">0</div>
                    <div class="stat-label">현재 페이지 작가</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" th:text="${totalPages != null ? totalPages : 0}">0</div>
                    <div class="stat-label">전체 페이지</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" th:text="${currentPage != null ? currentPage + 1 : 1}">1</div>
                    <div class="stat-label">현재 페이지</div>
                </div>
            </div>

            <!-- 팔로잉 목록 -->
            <div class="content-table">
                <div th:if="${followings == null || followings.empty}" class="empty-state">
                    <h3>팔로우 중인 작가가 없습니다</h3>
                    <p>관심 있는 작가를 팔로우하면 최신 작품을 확인할 수 있습니다.</p>
                    <a href="/products/category/artwork" class="btn btn-primary">작품 둘러보기</a>
                </div>

                <div th:if="${followings != null && !followings.empty}">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>프로필</th>
                                <th>작가명</th>
                                <th>팔로우 시작일</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="following : ${followings}" class="table-row">
                                <td>
                                    <div class="following-profile"
                                        th:text="${#strings.substring(following.name, 0, 1)}">작
                                    </div>
                                </td>
                                <td class="following-name" th:text="${following.name}">
                                    작가명</td>
                                <td class="content-time"
                                    th:text="${following.followDate != null ? following.followDate.toString().substring(0, 16).replace('T', ' ') : ''}">
                                    팔로우 시작일
                                </td>
                                <td>
                                    <a th:href="@{/products/author(authorId=${following.id})}" class="btn btn-primary"
                                        style="width: auto; display: inline-block; padding-top: 8px; padding-bottom: 8px; line-height: 1; vertical-align: middle; height: 38px;">
                                        작품목록 보러가기
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 페이징 -->
            <nav th:if="${totalPages > 0}" aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                        <a class="page-link" th:href="@{/members/followings(page=${currentPage - 1})}">«</a>
                    </li>
                    <li class="page-item" th:each="pageNum : ${#numbers.sequence(0, totalPages - 1)}"
                        th:classappend="${pageNum == currentPage} ? 'active'">
                        <a class="page-link" th:href="@{/members/followings(page=${pageNum})}"
                            th:text="${pageNum + 1}">1</a>
                    </li>
                    <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
                        <a class="page-link" th:href="@{/members/followings(page=${currentPage + 1})}">»</a>
                    </li>
                </ul>
            </nav>
        </main>
    </div>

    <!-- 현재 사용자 정보를 전역 변수로 설정 -->
    <script th:inline="javascript">
        window.currentUser = {
            id: /*[[${#authentication.principal.id}]]*/ null,
            email: /*[[${#authentication.principal.email}]]*/ null,
            name: /*[[${#authentication.principal.name}]]*/ null
        };
        console.log('현재 사용자 정보:', window.currentUser);
    </script>

    <!-- heartFollow.js를 로드하고 함수가 제대로 등록되었는지 확인 -->
    <script src="/js/heartFollow.js"></script>
    <!-- JavaScript 완전 제거 -->
</body>

</html>