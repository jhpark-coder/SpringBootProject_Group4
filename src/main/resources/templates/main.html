<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security" layout:decorate="~{fragment/layout}">

<head>
    <!-- 이 페이지의 CSS를 layout.html에 전달 -->
    <th:block layout:fragment="css">
        <link rel="stylesheet" th:href="@{/css/main.css}">
        <link rel="stylesheet" th:href="@{/css/heartFollow.css}">
        <style>
            .popup-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                justify-content: center;
                align-items: center;
                z-index: 999;
            }

            .popup-container {
                background-color: #ffffff;
                padding: 40px;
                border-radius: 20px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                text-align: center;
                max-width: 400px;
                width: 90%;
            }

            .popup-message {
                font-size: 1.1rem;
                font-weight: 500;
                color: #333;
                margin: 0;
                margin-bottom: 30px;
                line-height: 1.6;
            }

            .popup-button {
                background-color: #007bff;
                color: #ffffff;
                border: none;
                border-radius: 8px;
                padding: 12px 30px;
                font-size: 1rem;
                font-weight: bold;
                cursor: pointer;
                transition: background-color 0.2s ease-in-out;
            }

            .popup-button:hover {
                background-color: #0056b3;
            }

            .popup-overlay.show {
                display: flex;
            }
        </style>
    </th:block>
    <title>Nexus - 당신의 창작품, 세상과 만나다</title>
</head>

<body>
    <!-- layout.html의 content fragment를 이 내용으로 교체 -->
    <div layout:fragment="content">
        <!-- 1. 메인 슬라이드 섹션 -->
        <section class="main-slide" id="main-slide">
            <div class="container main-slide-content">
                <div class="main-slide-text">
                    <h1>Art<br>Design<br>&<br>Java<br>FrontEnd</h1>
                    <a href="#needs-grid" class="btn">작품보러가기</a>
                </div>
            </div>
        </section>

        <!-- 2. 작품 추천 그리드 섹션 -->
        <section class="needs-grid" id="needs-grid">
            <div class="container" style="flex-direction: column; align-items: flex-start; max-width: 1180px;">
                <!-- 로그인 사용자에게만 보이는 제목 -->
                <h2 sec:authorize="isAuthenticated()"
                    style="width:100%; text-align: left; margin-bottom: 2rem; font-weight: 500;">
                    <span sec:authentication="principal.name" style="font-weight: 700;">홍길동</span>님을 위한 작품 추천!
                </h2>
                <!-- 비로그인 사용자에게 보이는 제목 -->
                <h2 sec:authorize="!isAuthenticated()"
                    style="width:100%; text-align: left; margin-bottom: 2rem; font-weight: 500;">
                    새로운 작품들
                </h2>

                <div class="row" id="main-product-grid">
                    <!-- JS로만 상품 리스트를 동적으로 렌더링합니다. -->
                </div>
                <!-- 상품이 없을 경우 메시지 -->
                <div th:if="${productPage == null or productPage.products.isEmpty()}"
                    style="width:100%; text-align: center; padding: 4rem 0; display:none;">
                    <p style="font-size: 1.2rem; color: #555;">
                        등록된 상품이 없습니다.
                    </p>
                </div>
            </div>
        </section>

        <!-- 3. 경매 홍보 섹션 (Call to Auction) -->
        <section class="auction-cta">
            <div class="container auction-cta-content">
                <p class="cta-text">이제 정말 좋은 작품들을<br>경매를 통해 보다 필요한 사람과 거래해보세요.</p>
                <!-- 경매 기능은 추후 구현 -->
                <a th:href="@{/auction}" class="btn">경매보러가기</a>
            </div>
        </section>

        <!-- 4. 작가 등록 추천 섹션 -->
        <section class="sell-recommend" sec:authorize="hasRole('ROLE_USER') and !hasRole('ROLE_SELLER') and !hasRole('ROLE_ADMIN')">
            <div class="container sell-recommend-content">
                <div class="sell-image-placeholder"></div>
                <div class="sell-text-content">
                    <p class="sell-description">창의적인 디자인 아트워크부터 논리적인 자바 코드구조까지 <br>정당한 비용을 받고 공유해보세요!</p>
                    <a href="#" class="btn" id="sellerApplyBtn">작가 등록하기</a>
                </div>
            </div>
        </section>

        <!-- 페이지네이션은 새로운 디자인에 포함되지 않으므로 제거됩니다. -->
        
        <!-- 팝업 오버레이 -->
        <div id="popupOverlay" class="popup-overlay">
            <div class="popup-container">
                <p id="popupMessage" class="popup-message"></p>
                <button class="popup-button" onclick="closePopup()">확인</button>
            </div>
        </div>
    </div>

    <th:block layout:fragment="script">
        <script th:src="@{/js/heartFollow.js}"></script>
        <script th:src="@{/js/main.js}"></script>
        <script>
            $(document).ready(function() {
                // 작가 신청 버튼 클릭 이벤트
                $("#sellerApplyBtn").on("click", function(e) {
                    e.preventDefault();
                    
                    $.ajax({
                        url: "/seller-request/apply",
                        type: "POST",
                        success: function(response) {
                            showPopup(response);
                        },
                        error: function(xhr) {
                            // 서버가 구체적인 에러 메시지를 보내주는 경우 그것을 사용하고,
                            // 그렇지 않으면 일반적인 메시지를 표시합니다.
                            var errorMessage = xhr.responseText || "작가 신청 중 오류가 발생했습니다.";
                            showPopup(errorMessage);
                        }
                    });
                });

                // 팝업 표시 함수
                function showPopup(message) {
                    $("#popupMessage").text(message);
                    $("#popupOverlay").addClass("show");
                }

                // 팝업 닫기 함수
                window.closePopup = function() {
                    $("#popupOverlay").removeClass("show");
                };
            });
        </script>
    </th:block>
</body>

</html>