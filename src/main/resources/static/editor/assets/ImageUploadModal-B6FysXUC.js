import{j as e}from"./index-b-_zDGuv.js";import{r as n}from"./tiptap-vendor-C2mi-KzI.js";import"./react-vendor-DeqkGhWy.js";import"./icons-vendor-8W8gD9qm.js";import"./utils-vendor-JBSp_YRO.js";const C=({onClose:c,onImageAdd:g})=>{const[i,h]=n.useState(""),[y,U]=n.useState(""),[f,d]=n.useState(!1),[R,o]=n.useState(0);n.useRef(null);const[l,b]=n.useState(null),[x,m]=n.useState(""),j=()=>{if(!i){alert("Please enter a URL.");return}g({src:i,alt:y}),c()},v=r=>{var t;const p=(t=r.target.files)==null?void 0:t[0];p&&(b(p),m(""))},N=async()=>{if(!l){m("Please select a file.");return}if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(l.type)){m("지원하지 않는 이미지 형식입니다.");return}const p=10*1024*1024;if(l.size>p){m("이미지 파일 크기는 10MB를 초과할 수 없습니다.");return}d(!0),o(0);try{const t=new FormData;t.append("file",l);const a=new XMLHttpRequest;a.upload.addEventListener("progress",s=>{if(s.lengthComputable){const u=Math.round(s.loaded/s.total*100);o(u)}}),a.addEventListener("load",()=>{if(a.status===200)try{console.log("Raw response:",a.responseText);const s=a.responseText;if(console.log("Image URL:",s),s&&s.trim()!==""&&s!=="[]"){const u=`http://localhost:8080${s}`;console.log("Full image URL:",u),g({src:u,alt:l.name}),c()}else console.error("Empty or invalid response from server:",s),alert("이미지 업로드 중 오류가 발생했습니다. 서버에서 유효한 URL을 반환하지 않았습니다.")}catch(s){console.error("응답 파싱 오류:",s),console.error("Response text:",a.responseText),alert("이미지 업로드 중 오류가 발생했습니다.")}else console.error("업로드 실패:",a.status,a.responseText),alert("이미지 업로드에 실패했습니다.");d(!1),o(0)}),a.addEventListener("error",()=>{console.error("업로드 오류"),alert("이미지 업로드 중 오류가 발생했습니다."),d(!1),o(0)}),a.open("POST","/editor/api/upload"),a.send(t)}catch(t){console.error("파일 처리 오류:",t),alert("이미지 처리 중 오류가 발생했습니다."),d(!1),o(0)}};return e.jsx("div",{className:"modal-overlay fancy-modal-overlay",onClick:c,children:e.jsxs("div",{className:"modal-content fancy-modal-content animate-fadeIn",onClick:r=>r.stopPropagation(),children:[e.jsx("h2",{className:"fancy-modal-title",children:"이미지 업로드"}),e.jsxs("div",{className:"modal-section",style:{marginBottom:"1.2rem"},children:[e.jsx("label",{className:"fancy-label",children:"URL로 이미지 추가"}),e.jsxs("div",{className:"fancy-url-input-group",children:[e.jsx("input",{type:"url",placeholder:"https://example.com/image.jpg",value:i,onChange:r=>h(r.target.value),className:"fancy-input"}),e.jsx("button",{onClick:j,className:"fancy-embed-btn",disabled:!i,children:"추가"})]})]}),e.jsxs("div",{className:"modal-section",children:[e.jsx("label",{className:"fancy-label",children:"파일 업로드"}),e.jsxs("div",{className:"fancy-file-upload-group",style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx("input",{type:"file",accept:"image/*",id:"image-upload-input",style:{display:"none"},onChange:v}),e.jsx("label",{htmlFor:"image-upload-input",className:"fancy-embed-btn fancy-file-btn",children:"파일 선택"}),l&&e.jsx("span",{className:"fancy-file-name",children:l.name})]})]}),x&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-700 rounded",children:x}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("button",{onClick:N,className:"fancy-embed-btn",disabled:!l||f,children:f?"업로드 중...":"업로드"}),e.jsx("button",{onClick:c,className:"fancy-embed-btn",disabled:f,children:"취소"})]})]})})};export{C as default};
