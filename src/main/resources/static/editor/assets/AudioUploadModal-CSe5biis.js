import{j as e}from"./index-D8cLYlCR.js";import{r as n}from"./tiptap-vendor-C2mi-KzI.js";import"./react-vendor-DeqkGhWy.js";import"./icons-vendor-8W8gD9qm.js";import"./utils-vendor-JBSp_YRO.js";const k=({onClose:i,onAudioAdd:h})=>{const[c,g]=n.useState(""),[m,d]=n.useState(!1),[S,o]=n.useState(0);n.useRef(null);const[l,b]=n.useState(null),[x,y]=n.useState(""),j=()=>{if(!c){alert("Please enter an audio URL.");return}h({src:c}),i()},N=async r=>{const t=r.target.files[0];if(!t)return;const f=50*1024*1024;if(t.size>f){alert("오디오 파일 크기는 50MB를 초과할 수 없습니다.");return}if(!t.type.startsWith("audio/")){alert("오디오 파일만 업로드 가능합니다.");return}d(!0),o(0);try{const p=new FormData;p.append("file",t);const s=new XMLHttpRequest;s.upload.addEventListener("progress",a=>{if(a.lengthComputable){const u=Math.round(a.loaded/a.total*100);o(u)}}),s.addEventListener("load",()=>{if(s.status===200)try{console.log("Raw response:",s.responseText);const a=s.responseText;if(console.log("Audio URL:",a),a&&a.trim()!==""&&a!=="[]"){const u=`http://localhost:8080${a}`;console.log("Full audio URL:",u),h({src:u}),i()}else console.error("Empty response from server"),alert("오디오 업로드 중 오류가 발생했습니다.")}catch(a){console.error("응답 파싱 오류:",a),console.error("Response text:",s.responseText),alert("오디오 업로드 중 오류가 발생했습니다.")}else console.error("업로드 실패:",s.status,s.responseText),alert("오디오 업로드에 실패했습니다.");d(!1),o(0)}),s.addEventListener("error",()=>{console.error("업로드 오류"),alert("오디오 업로드 중 오류가 발생했습니다."),d(!1),o(0)}),s.open("POST","/editor/api/upload"),s.send(p)}catch(p){console.error("파일 처리 오류:",p),alert("오디오 처리 중 오류가 발생했습니다."),d(!1),o(0)}},v=r=>{const t=r.target.files[0];if(!t)return;const f=50*1024*1024;if(t.size>f){alert("오디오 파일 크기는 50MB를 초과할 수 없습니다.");return}if(!t.type.startsWith("audio/")){alert("오디오 파일만 업로드 가능합니다.");return}b(t),y("")},U=()=>{if(!l){y("Please select a file.");return}N({target:{files:[l]}})};return e.jsx("div",{className:"modal-overlay fancy-modal-overlay",onClick:i,children:e.jsxs("div",{className:"modal-content fancy-modal-content animate-fadeIn",onClick:r=>r.stopPropagation(),children:[e.jsx("h2",{className:"fancy-modal-title",children:"오디오 업로드"}),e.jsxs("div",{className:"modal-section",style:{marginBottom:"1.2rem"},children:[e.jsx("label",{className:"fancy-label",children:"URL로 오디오 추가"}),e.jsxs("div",{className:"fancy-url-input-group",children:[e.jsx("input",{type:"url",placeholder:"https://example.com/audio.mp3",value:c,onChange:r=>g(r.target.value),className:"fancy-input"}),e.jsx("button",{onClick:j,className:"fancy-embed-btn",disabled:!c,children:"추가"})]})]}),e.jsxs("div",{className:"modal-section",children:[e.jsx("label",{className:"fancy-label",children:"파일 업로드"}),e.jsxs("div",{className:"fancy-file-upload-group",style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx("input",{type:"file",accept:"audio/*",id:"audio-upload-input",style:{display:"none"},onChange:v}),e.jsx("label",{htmlFor:"audio-upload-input",className:"fancy-embed-btn fancy-file-btn",children:"파일 선택"}),l&&e.jsx("span",{className:"fancy-file-name",children:l.name})]})]}),x&&e.jsx("div",{className:"mb-4 p-2 bg-red-100 text-red-700 rounded",children:x}),l&&e.jsxs("div",{className:"mb-4 p-2 bg-gray-100 rounded",children:[e.jsxs("p",{children:["선택된 파일: ",l.name]}),e.jsxs("p",{children:["크기: ",(l.size/1024/1024).toFixed(2)," MB"]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:U,className:"fancy-embed-btn",disabled:!l||m,children:m?"업로드 중...":"업로드"}),e.jsx("button",{onClick:i,className:"fancy-embed-btn",disabled:m,children:"취소"})]})]})})};export{k as default};
